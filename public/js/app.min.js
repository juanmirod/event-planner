!function(){"use strict";angular.module("planner",["ngRoute","ngAnimate","ui.bootstrap.collapse","ui.bootstrap.tpls","planner.login","planner.signup","planner.home","planner.event","firebase","firebaseAPI"]).run(["$rootScope","$location",function(e,t){e.$on("$routeChangeError",function(e,n,r,o){"AUTH_REQUIRED"===o&&t.path("/")})}]).config(["$locationProvider","$routeProvider",function(e,t){e.hashPrefix("!"),t.otherwise({redirectTo:"/"})}]).controller("AppController",["$rootScope","$scope","$location","Auth","Users",function(e,t,n,r,o){t.auth=r,t.$location=n,t.isCollapsed=!0,t.auth.$onAuthStateChanged(function(e){e?(t.firebaseUser=e,o.get(e.uid).$loaded(function(e){t.firebaseUser.name=e.name,t.firebaseUser.bio=e.bio})):t.firebaseUser=void 0}),t.$on("$routeChangeStart",function(){t.isCollapsed=!0})}]).directive("autofocus",[function(){return{restrict:"A",link:function(e,t){t[0].focus()}}}])}(),function(){"use strict";var e={apiKey:"AIzaSyBLdzEKg3XtsvI0JaXL1wTiW7hdxDkrzWU",authDomain:"udacity-event-planner-7ce8e.firebaseapp.com",databaseURL:"https://udacity-event-planner-7ce8e.firebaseio.com",storageBucket:"udacity-event-planner-7ce8e.appspot.com"};firebase.initializeApp(e),angular.module("firebaseAPI",[]).constant("FirebaseUrl","https://udacity-event-planner-7ce8e.firebaseio.com").service("RootRef",function(){return firebase.database().ref()}).service("Users",["RootRef","$firebaseArray","$firebaseObject",function(e,t,n){var r=e.child("users");this.list=t(r),this.get=function(e){return n(r.child(e))},this.newUser=function(e){return r.child(e)}}]).service("Events",["RootRef","$firebaseArray","$firebaseObject",function(e,t,n){var r=e.child("events");this.list=t(r),this.get=function(e){return n(r.child(e))}}]).factory("Auth",["$firebaseAuth",function(e){return e()}])}(),function(){"use strict";angular.module("planner.validators",[]).directive("password",function(){return{require:"ngModel",link:function(e,t,n,r){r.$validators.password=function(t,n){e.passwordErrorMessages=[],e.valid=!0;var o=function(t){e.passwordErrorMessages.push(t)};if(r.$isEmpty(t))return o("This field is required"),!1;n.match(/[^A-z0-9\\!\\@\\#\\$\\%\\^\\&\\*]/)&&(o("The password constains illegal characters."),e.valid=!1),(n.length<10||n.length>100)&&(o("The password must be between 10 and 100 characters long."),e.valid=!1);var a=[["[\\!\\@\\#\\$\\%\\^\\&\\*]","It must contain at least one of this symbols: !@#$%^&*"],["\\d","It must contain a number"],["[a-z]","It must contain a lowercase character"],["[A-Z]","It must contain an uppercase character"]];return a.forEach(function(t){var r=new RegExp(t[0],"g");r.test(n)||(o(t[1]),e.valid=!1)}),e.valid}}}})}(),function(){"use strict";angular.module("planner.event",["ngRoute","ngMap","firebase","firebaseAPI"]).constant("EventTypes",[{name:"Conference",icon:"glyphicon-user"},{name:"Company Meet-up",icon:"glyphicon-user"},{name:"Sport event",icon:"glyphicon-flag"},{name:"Birthday Party",icon:"glyphicon-gift"},{name:"Wedding",icon:"glyphicon-heart"},{name:"Newborn party",icon:"glyphicon-baby-formula"},{name:"Pokemon Championship",icon:"glyphicon-star"}]).config(["$routeProvider",function(e){e.when("/create",{templateUrl:"js/views/event/event_form.html",controller:"CreateCtrl",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}]}}),e.when("/edit/:ref",{templateUrl:"js/views/event/event_form.html",controller:"CreateCtrl",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}]}})}]).controller("CreateCtrl",["$scope","Events","$route","$timeout","currentAuth","NgMap","EventTypes",function(e,t,n,r,o,a,i){function s(n){var r=t.get(n);e.event=r,e.saveDisabled=!0,r.$loaded().then(function(t){e.saveDisabled=!1,e.event._start_date_form=new Date(e.event.start_date),e.event._end_date_form=new Date(e.event.end_date)})}function c(){e.event.created_at=Date.now(),e.event.created_by=o.uid,t.list.$add(e.event).then(function(t){e.saveDisabled=!0,e.infoMessage="Event saved successfully! You can see it on the events list now.",e.ref=t.key,s(t.key),r(e.continueEditing,1e3)}).catch(function(t){e.errorMessage="There was an error trying to create the event: "+t.message})}function u(){e.event.$save().then(function(t){e.saveDisabled=!0,e.infoMessage="Event saved successfully!",r(e.continueEditing,1e3)}).catch(function(t){e.errorMessage="There was an error trying to update the event: "+t.message})}e.event={},e.triedLocation=!1,a.getMap().then(function(t){e.map=t}),"undefined"!=typeof n.current.params.ref&&(e.ref=n.current.params.ref,s(e.ref)),e.eventIcon=function(e){var t="glyphicon-map-marker";return i.some(function(n){n.name==e.type&&(t=n.icon)}),t},e.submitHandler=function(t){t.$valid?(e.event.start_date=new Date(e.event._start_date_form).getTime(),e.event.end_date=new Date(e.event._end_date_form).getTime(),"undefined"!=typeof e.ref?u():c()):e.errorMessage="Please check that all required fields are filled and dates are correctly formatted."},e.getLocation=function(){navigator.geolocation&&!e.triedLocation&&(e.triedLocation=!0,navigator.geolocation.getCurrentPosition(function(t){e.event.location="["+t.coords.latitude+", "+t.coords.longitude+"]",e.located=!0,e.$apply(),e.map.setCenter({lat:t.coords.latitude,lng:t.coords.longitude})},function(t){e.event.location="Sorry, but we couldn't get your location",e.$apply(),console.log("There was an error trying to get the user location: ",t)}))},e.locationChangedHandler=function(){this.position?(e.map.setCenter(this.position),e.event.location=this.position.toString(),e.$apply()):(e.place=this.getPlace(),e.map.setCenter(e.place.geometry.location))},e.continueEditing=function(){e.saveDisabled=!1,e.infoMessage=void 0}}])}(),function(){"use strict";angular.module("planner.home",["firebaseAPI","ngRoute","ngMap","planner.event"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"js/views/home/home.html",controller:"HomeCtrl",resolve:{currentAuth:["Auth",function(e){return e.$waitForSignIn()}]}})}]).controller("HomeCtrl",["$rootScope","$scope","Events","currentAuth","EventTypes",function(e,t,n,r,o){function a(e,t){return e.start_date<t.start_date?-1:e.start_date>t.start_date?1:0}e.authUser=r,t.toggleMap=function(e){e._showMap?e._showMap=!1:e._showMap=!0},t.userHasCreated=function(e,t){return!(!t||!e.created_by)&&e.created_by==t.uid},t.eventIcon=function(e){var t="glyphicon-map-marker";return o.some(function(n){n.name==e.type&&(t=n.icon)}),t},n.list.sort(a),t.events=n.list,n.list.$watch(function(){n.list.sort(a)})}])}(),function(){"use strict";angular.module("planner.login",["ngRoute","firebaseAPI"]).config(["$routeProvider",function(e){e.when("/login",{templateUrl:"js/views/login/login.html",controller:"LoginCtrl",resolve:{currentAuth:["Auth",function(e){return e.$waitForSignIn()}]}})}]).controller("LoginCtrl",["$rootScope","$scope","Auth","$location",function(e,t,n,r){t.email="",t.password="",t.submitHandler=function(e){if(e.$valid){var o=n.$signInWithEmailAndPassword(t.email,t.password);o.then(function(e){r.path("/")}).catch(function(e){t.error="Authentication failed: "+e})}}}])}(),function(){"use strict";angular.module("planner.signup",["ngRoute","planner.validators","firebaseAPI"]).config(["$routeProvider",function(e){e.when("/signup",{templateUrl:"js/views/signup/signup.html",controller:"SignupCtrl"})}]).controller("SignupCtrl",["$rootScope","$scope","$location","Auth","Users",function(e,t,n,r,o){t.submitHandler=function(e){e.$valid&&r.$createUserWithEmailAndPassword(t.user.email,t.user.password).then(function(e){return t.firebaseUser=e,console.log(e),o.newUser(e.uid).set({name:t.user.name,bio:t.user.bio||""})}).then(function(e){n.path("/")}).catch(function(e){t.authError="There was an error trying to create the user: "+e.message,"undefined"!=typeof t.firebaseUser&&t.firebaseUser.delete().catch(function(e){console.log("Removing the user with errors failed, time to go home..."),t.authError+=e})})}}])}();